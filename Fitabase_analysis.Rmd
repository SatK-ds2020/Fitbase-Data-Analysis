---
title: "R Notebook"
output: html_notebook
---

## Introduction and background
This is meant to be a sample starter script if you choose to use R for this case study. This is not comprehensive of everything you'll do in the case study, but should be used as a starting point if it is helpful for you.

## Upload your CSV files to R
Remember to upload your CSV files to your project from the relevant data source:
https://www.kaggle.com/arashnic/fitbit

Remember, there are many different CSV files in the dataset. We have uploaded two CSVs into the project, but you will likely want to use more than just these two CSV files.

## Installing and loading common packages and libraries
You can always install and load packages along the way as you may discover you need different packages after you start your analysis. If you already have some of these packages installed and loaded, you can skip those ones - or you can choose to run those specific lines of code anyway. It may take a few moments to run.

```{r include=FALSE}
library(readr)
library(data.table)
library(tidyverse)
library(dplyr)
library(lubridate)
library(skimr)
library(janitor)
library(magrittr)
library(stringr)
library(gridExtra)
```

## Loading your CSV files
Here we'll create a dataframe named 'daily_activity' and read in one of the CSV files from the dataset.Then, we rename the variable ActivityDate by another name that will be common variables in another dataframe.

```{r}
## loading the data
daily_activity<- read_csv("dailyActivity_merged.csv")
head(daily_activity)
colnames(daily_activity)
## changing the date column in proper date and time format
daily_activity$ActivityDate<-mdy(daily_activity$ActivityDate)

## renaming the variables
daily_activity<-daily_activity %>% 
  rename(
    Activity_Sleep_Day= ActivityDate 
    )

## look for the unique Ids in the dataframe
n_distinct(daily_activity$Id)
```
# some quick summary statistics we'd want to know about each data frame

For the daily activity dataframe:
```{r}
daily_activity %>%  
  select(TotalSteps,
         TotalDistance,
         SedentaryMinutes) %>%
  summary()
```

## Plotting a few explorations

Finding the relationship between steps taken in a day and sedentary minutes. How could this help inform the customer segments that we can market to? E.g. position this more as a way to get started in walking more? Or to measure steps that you're already taking?

```{r}
ggplot(data=daily_activity, aes(x=TotalSteps, y=SedentaryMinutes)) + geom_point() +geom_smooth()
```




## We'll create another dataframe for the sleep data. 
```{r}
sleep_day <- read_csv("sleepDay_merged.csv")

colnames(sleep_day)

sleep_day$SleepDay<-mdy_hms(sleep_day$SleepDay)

sleep_day <- sleep_day %>% 
  rename(
    Activity_Sleep_Day= SleepDay
    
    )

head(sleep_day)
# looking for the unique Ids
n_distinct(sleep_day$Id)

```
# For the sleep dataframe:
```{r}
sleep_day %>%  
  select(TotalSleepRecords,
  TotalMinutesAsleep,
  TotalTimeInBed) %>%
  summary()
```
What's the relationship between minutes asleep and time in bed? You might expect it to be almost completely linear - are there any unexpected trends?

```{r}
ggplot(data=sleep_day, aes(x=TotalMinutesAsleep, y=TotalTimeInBed)) + geom_point() + geom_smooth()
```

## Merging these two datasets together:outer full join

```{r}
# joining the data with full outer join
Dailyactivity_sleepday <- merge(daily_activity,sleep_day, by=c("Id","Activity_Sleep_Day"),all=T)
head(Dailyactivity_sleepday)
colnames(Dailyactivity_sleepday)
## unique Ids in combined dataframe
n_distinct(Dailyactivity_sleepday$Id)
```
# removing NA rows,considering only rows that have complete data for all the variables
```{r}
## making some space and removing the data that is not needed now
rm(daily_activity,sleep_day)

Dailyactivity_sleepday_narm<-na.omit(Dailyactivity_sleepday)
colnames(Dailyactivity_sleepday_narm)

## which Id having the max total distance
Dailyactivity_sleepday_narm[which.max(Dailyactivity_sleepday_narm$TotalDistance,10),]
```

## Summary Statistics for the combined dataframe:
```{r}
Dailyactivity_sleepday_narm%>%
  select(TotalSteps,TotalDistance,SedentaryMinutes,Calories,TotalTimeInBed,TotalMinutesAsleep,VeryActiveMinutes) %>%
summary()
```
Now we can explore some different relationships between activity and sleep as well. For example, knowing whether participants who sleep more also take more steps or fewer steps per day? Is there a relationship at all? How could these answers help inform the marketing strategy of how we position this new product?
#Plotting the graphs and find some relationship
```{r}
p1<-ggplot(Dailyactivity_sleepday_narm,aes(x=VeryActiveMinutes,y=Calories,color=TotalTimeInBed)) + geom_point() + geom_smooth()+geom_jitter()
p2<-ggplot(Dailyactivity_sleepday_narm,aes(x=TotalSteps,y=Calories,color=VeryActiveMinutes)) + geom_point() + geom_smooth()+geom_jitter()
p3<-ggplot(Dailyactivity_sleepday_narm,aes(x=TotalDistance,y=Calories, color=VeryActiveDistance)) + geom_point() + geom_smooth()+geom_jitter()
p4<-ggplot(Dailyactivity_sleepday_narm,aes(x=SedentaryMinutes,y=TotalSteps, color=VeryActiveMinutes)) + geom_point() + geom_smooth()+geom_jitter()
p5<-ggplot(Dailyactivity_sleepday_narm,aes(x=SedentaryMinutes,y=TotalDistance,color=VeryActiveDistance)) + geom_point() + geom_smooth() + geom_jitter()
p6<-ggplot(Dailyactivity_sleepday_narm,aes(x=SedentaryMinutes,y=Calories,color=TotalTimeInBed)) + geom_point() + geom_smooth() + geom_jitter()
p7<-ggplot(Dailyactivity_sleepday_narm,aes(x=TotalMinutesAsleep,y=Calories,color=SedentaryMinutes)) + geom_point() + geom_smooth()+geom_jitter()
p8<-ggplot(Dailyactivity_sleepday_narm,aes(x=TotalMinutesAsleep,y=TotalDstance,color=VeryActiveMinutes)) + geom_point() + geom_smooth()+geom_jitter()
p9<-ggplot(Dailyactivity_sleepday_narm,aes(x=TotalMinutesAsleep,y=TotalSteps,color=VeryActiveMinutes)) + geom_point() + geom_smooth() + geom_jitter()

p_combined<-grid.arrange(p1,p2,p3,p4,p5,p6,p7,p8,p9,nrow=9)

```


## Exploring the daily Calories dataframe,but we can ignor it since we already having the calories variable in our daily_activty dataframe.

```{r}
daily_calories <- read_csv("dailyCalories_merged.csv")
head(daily_calories)
tail(daily_calories)
colnames(daily_calories)
daily_calories$ActivityDay<-mdy(daily_calories$ActivityDay)
```
## Exploring a few key tables

```{r}
#loading heartrate dataframe
heart_rate <- read_csv("heartrate_seconds_merged.csv")
colnames(heart_rate)
heart_rate$Time<-mdy_hms(heart_rate$Time)
head(heart_rate)
```
Divide and transform the data according to months for clear monthly analysis:
```{r}

#mutate data in a timely manner

april_data<-heart_rate%>%
  mutate(minute=minute(Time),hour=hour(Time),day=day(Time),month=month(Time))%>%filter(month==4)
head(april_data)

may_data<-heart_rate%>%
  mutate(minute=minute(Time),hour=hour(Time),day=day(Time),month=month(Time))%>%filter(month==5)
head(may_data)

# remove heart_rate data
rm(heart_rate)
```

##April month analysis
```{r}
p31<-april_data%>%
  group_by(minute) %>%
  summarise(sum_Value=sum(Value,na.rm = TRUE),mean_value=mean(Value,na.rm=TRUE))%>%
  ggplot(aes(x=minute, y=sum_Value))+
  geom_line(show.legend = F)+scale_x_continuous(breaks = seq(0, 65, by = 5))+
  labs(x="Minutes",y="Heart Rate")


p32<-april_data%>%
  group_by(hour) %>%
  summarise(sum_Value=sum(Value,na.rm = TRUE),mean_value=mean(Value,na.rm=TRUE))%>%
  ggplot(aes(x=hour, y=sum_Value))+
  geom_line(stat="identity",show.legend = F)+scale_x_continuous(breaks = seq(0, 30, by = 1))+
  labs(x="Hours",y="Heart Rate")


p33<-april_data%>%
  group_by(day) %>%
  summarise(sum_Value=sum(Value,na.rm = TRUE),mean_value=mean(Value,na.rm=TRUE))%>%
  ggplot(aes(x=day, y=sum_Value))+
  geom_line(stat="identity",show.legend = F)+scale_x_continuous(breaks = seq(0, 31, by = 1))+
  labs(x="Days",y="Heart Rate")

p_heartrate_4<-grid.arrange(p31,p32,p33,nrow=3)
```

##May month analysis
```{r}
p21<-may_data%>%
  group_by(minute) %>%
  summarise(sum_Value=sum(Value,na.rm = TRUE),mean_value=mean(Value,na.rm=TRUE))%>%
  ggplot(aes(x=minute, y=sum_Value))+
  geom_line(show.legend = F)+scale_x_continuous(breaks = seq(0, 65, by = 5))+
  labs(x="Minutes",y="Heart Rate")


p22<-may_data%>%
  group_by(hour) %>%
  summarise(sum_Value=sum(Value,na.rm = TRUE),mean_value=mean(Value,na.rm=TRUE))%>%
  ggplot(aes(x=hour, y=sum_Value))+
  geom_line(stat="identity",show.legend = F)+scale_x_continuous(breaks = seq(0, 30, by = 1))+
  labs(x="Hours",y="Heart Rate")


p23<-may_data%>%
  group_by(day) %>%
  summarise(sum_Value=sum(Value,na.rm = TRUE),mean_value=mean(Value,na.rm=TRUE))%>%
  ggplot(aes(x=day, y=sum_Value))+
  geom_line(stat="identity",show.legend = F)+scale_x_continuous(breaks = seq(0, 31, by = 1))+
  labs(x="Days",y="Heart Rate")

p_heartrate_5<-grid.arrange(p21,p22,p23,nrow=3)
```

## Exploring the data further for hourly observations from some key tables:

```{r}
hourly_intensity <- read_csv("hourlyIntensities_merged.csv")
head(hourly_intensity)
hourly_intensity$ActivityHour<-mdy_hms(hourly_intensity$ActivityHour)

```
```{r}
hourly_steps <- read_csv("hourlySteps_merged.csv")
head(hourly_steps)
hourly_steps$ActivityHour<-mdy_hms(hourly_steps$ActivityHour)
```
```{r}
hourly_Calories <- read_csv("hourlyCalories_merged.csv")
head(hourly_Calories)
hourly_Calories$ActivityHour<-mdy_hms(hourly_Calories$ActivityHour)
```
##Merge the hourly data frames
```{r}
combined_hourly<-merge(hourly_intensity,hourly_steps,by=c("Id","ActivityHour"),all=T)
combined_hourly<-merge(combined_hourly,hourly_Calories,by=c("Id","ActivityHour"),all=T)
head(combined_hourly)
```
```{r}
rm(hourly_Calories,hourly_intensity,hourly_steps)
n_distinct(combined_hourly$Id)

```

#transform the combined hourly data for ploting the graph in a timely manner
```{r}
combined_hourly<- combined_hourly%>%mutate(month=month(ActivityHour,abbr = T),day=day(ActivityHour),hour=hour(ActivityHour),weekday=weekdays(ActivityHour,abbreviate(T)))
glimpse(combined_hourly)
```

###finding the relationships by graphs

##Total Intensity for the month April
```{r}
p7<-combined_hourly%>% filter(month==4)%>% group_by(day)%>% summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=day,y=sum_TotalIntensity))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 31, by = 1))+labs(x="Days",y="Total Intensity")

p8<-combined_hourly%>% filter(month==4)%>% group_by(hour)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=hour,y=sum_TotalIntensity))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 24, by = 1))+labs(x="Hour",y="Total Intensity")

p9<-combined_hourly%>% filter(month==4)%>% group_by(weekday)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=factor(weekday),y=order(sum_TotalIntensity),fill=weekday))+geom_col(show.legend = F)+labs(x="Weekday",y="Total Intensity")

p_Intensity_4<-grid.arrange(p8,p7,p9,nrow=3)
```
## Total Intensity For the month May:
```{r}
p17<-combined_hourly%>% filter(month==5)%>% group_by(day)%>% summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=day,y=sum_TotalIntensity))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 31, by = 1))+labs(x="Days",y="Total Intensity")

p18<-combined_hourly%>% filter(month==5)%>% group_by(hour)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=hour,y=sum_TotalIntensity))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 24, by = 1))+labs(x="Hour",y="Total Intensity")

p19<-combined_hourly%>% filter(month==5)%>% group_by(weekday)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=factor(weekday),y=order(sum_TotalIntensity),fill=weekday))+geom_col(show.legend = F)+labs(x="Weekday",y="Total Intensity")
p_Intensity_5<-grid.arrange(p18,p17,p19,nrow=3)


```
#TotalSteps taken for the month April:
```{r}
p10<-combined_hourly%>%filter(month==4)%>% group_by(day)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=day,y=sum_Step))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 31, by = 1))+labs(x="Days",y="Total Steps")

p11<-combined_hourly%>%filter(month==4)%>% group_by(hour)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=hour,y=sum_Step))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 24, by = 1))+labs(x="Hour",y="Total Steps")

p12<-combined_hourly%>%filter(month==4)%>%
  group_by(weekday)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=factor(weekday),y=order(mean_step),fill=weekday))+geom_col(show.legend = F)+labs(x="Weekday",y="Total Steps")

p_steps_4<-grid.arrange(p11,p10,p12,nrow=3)
```

## TotalSteps taken For the month May:
```{r}
p13<-combined_hourly%>%filter(month==5)%>% group_by(day)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=day,y=sum_Step))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 31, by = 1))+labs(x="Days",y="Total Steps")

p14<-combined_hourly%>%filter(month==5)%>% group_by(hour)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=hour,y=sum_Step))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 24, by = 1))+labs(x="Hour",y="Total Steps")

p15<-combined_hourly%>%filter(month==5)%>%
  group_by(weekday)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=factor(weekday),y=order(mean_step),fill=weekday))+geom_col(show.legend = F)+labs(x="Weekday",y="Total Steps")

p_steps_5<-grid.arrange(p14,p13,p15,nrow=3)

```

#TotalCalories burn for the month April:
```{r}
p40<-combined_hourly%>%filter(month==4)%>% group_by(day)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=day,y=sum_cal))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 31, by = 1))+labs(x="Days",y="Total Calories")

p41<-combined_hourly%>%filter(month==4)%>% group_by(hour)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=hour,y=sum_cal))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 24, by = 1))+labs(x="Hour",y="Total Calories")

p42<-combined_hourly%>%filter(month==4)%>%
  group_by(weekday)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=factor(weekday),y=order(mean_cal),fill=weekday))+geom_col(show.legend = F)+labs(x="Weekday",y="Total Calories")

p_cal_4<-grid.arrange(p41,p40,p42,nrow=3)
```
# TotalCalories burn for May month
```{r}
p45<-combined_hourly%>%filter(month==5)%>% group_by(day)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=day,y=sum_cal))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 31, by = 1))+labs(x="Days",y="Total Calories")

p46<-combined_hourly%>%filter(month==5)%>% group_by(hour)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=hour,y=sum_cal))+geom_line(stat="identity")+scale_x_continuous(breaks = seq(0, 24, by = 1))+labs(x="Hour",y="Total Calories")

p47<-combined_hourly%>%filter(month==5)%>%
  group_by(weekday)%>%summarise(sum_Step=sum(StepTotal),mean_step=mean(StepTotal,na.rm=T),sum_cal=sum(Calories),mean_cal=mean(Calories,na.rm=T),sum_TotalIntensity=sum(TotalIntensity),mean_Intensity=mean(TotalIntensity,na.rm=T))%>% ggplot(aes(x=factor(weekday),y=order(mean_cal),fill=weekday))+geom_col(show.legend = F)+labs(x="Weekday",y="Total Calories")

p_cal_5<-grid.arrange(p46,p45,p47,nrow=3)


```


When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

